const pathCompatibility = require("../util/path-compatibility.js");
const serviceService = require("../services/bossesServices.service");

class servicesController {
  serviceService = new serviceService();

  // Get all findAllServices
  findAllService = async (req, res, next) => {
    try {
      // 쿼리스트링 가지고온다.
      // all, inprogress, completed 나눠야함
      const { status } = req.query;
      // 유저 id는 인증 미들웨어에서 가지고 온다 => res.locals.user
      const { id } = res.locals.user;

      const services = await this.serviceService.findAllService(id, status);
      res.status(200).json(services);
    } catch (error) {
      next(error);
    }
  };

  // Get findService
  findService = async (req, res, next) => {
    try {
      // 파라미터 가지고온다.
      const { serviceId } = req.params;
      // 유저 id는 인증 미들웨어에서 가지고 온다 => res.locals.user
      const { id } = res.locals.user;

      const service = await this.serviceService.findService(id, serviceId);
      res.status(200).json(service);
    } catch (error) {
      next(error);
    }
  };

  // update service status to one
  // updateServiceStatusToOne = async (req, res, next) => {
  //   try {
  //     const { serviceId } = req.params;
  //     const { id: bossId } = res.locals.user;

  //     if (updatedService === 0) {
  //       return res.status(400).json({ message: "error" });
  //     }

  //     res.status(200).json(updatedService);
  //   } catch (error) {
  //     next(error);
  //   }
  // };

  // update service status from one
  updateServiceStatus = async (req, res, next) => {
    try {
      const { serviceId } = req.params;
      const { id: bossId } = res.locals.user;

      // 서비스 아이디와 그 서비스의 상태 알아내서
      // 서비스 상태가 0 이면 updateServiceStatusToOne
      // 서비스 상태가 1 ~ 3이면 updateServiceStatus

      // const updatedService = await this.serviceService.updateServiceStatusToOne(
      //   bossId,
      //   serviceId
      // );

      const service = await this.serviceService.updateServiceStatus(
        bossId,
        serviceId
      );

      if (service === 0) {
        return res.status(400).json({ message: "error" });
      }

      res.status(200).json(service);
    } catch (error) {
      next(error);
    }
  };
}

module.exports = servicesController;
